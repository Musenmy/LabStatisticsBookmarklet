javascript:(async()=>{var l=t=>document.getElementById(t),t=t=>document.querySelectorAll(t),w="innerHTML",p="replace",$="createElement",y=($AC="appendChild",t=>`"${(t+"")[p](/\n/g,"")[p](/"/g,'""')}"`);let g="日時",v="ジャンル",C="コメ",_="リンク",k="タイトル",x="閲覧",s="リプ",b="チェーン",L="いいね",A="スター",j="シェア",D="</th><th>",E="</td><td>",u="処理中…",e;var n,a=new URL(window.location.href);if("www.hoyolab.com"!=a.hostname)return alert`HoYoLABを開いてね`;if(a.pathname.startsWith`/accountCenter`)e=1;else{if(!a.pathname.startsWith`/article`)return alert`プロフィールか投稿のページを開いてね`;e=2}if(1==e){let i=window.location.href.match(/[?&]id=([^&]+)/)[1];if(!i)return alert`IDが見つからないよ。URLを確認してね`;let t=o(),d=!1,c=l("CT");l("Cb").addEventListener("click",()=>{d=!0,t.close(),document.body.removeChild(t)}),r("ポスト統計表出力",async()=>{f(),c[w]="処理中…<br><br>";var[t,e,a,n,o,r]=await(async a=>{let s="\ufeff",t=0,[e,u,m,h,p,b]=[0,0,0,0,0,0],n=!1,f=document[$]("table");c[$AC](f);var o=document[$]("tr");o[w]=`<th>${g+D+v+D+k+_+D+x+D+C+D+L+D+A+D+j}</th>`,f[$AC](o),s+=[g,v,_,k,x,C,L,A,j].map(y).join(",")+"\r\n";do{if(d)return;var r=`https://bbs-api-os.hoyolab.com/community/post/wapi/userPost?offset=${t}&size=20&uid=`+a;try{var i=await(await fetch(r)).json();i.data.list.forEach(t=>{var{post:{post_id:t,created_at:e,subject:a},stat:{view_num:n,reply_num:o,like_num:r,bookmark_num:i,share_num:d},game:{game_name:c}}=t,e=S(e),t="https://www.hoyolab.com/article/"+t,l=document[$]("tr");l[w]=`<td>${e+E+c+E}<a href="${t}" target="_blank">${a}</a>${E+n+E+o+E+r+E+i+E+d}</td>`,f[$AC](l),s+=[e,c,t,a,n,o,r,i,d].map(y).join(",")+"\r\n",u+=n,m+=o,h+=r,p+=i,b+=d}),e+=i.data.list.length,{is_last:n,next_offset:t}=i.data}catch(t){c.textContent="エラー: "+t.message;break}}while(!n);return l("cD")&&l("cD").remove(),(o=document[$]("button")).textContent="CSV保存",o.id="cD",o.addEventListener("click",async()=>{var t=new Blob([s],{type:"text/csv"}),t=URL.createObjectURL(t),e=document[$]("a");e.href=t,e.download=`userPostSummary-${a}.csv`,e.click(),URL.revokeObjectURL(t)}),l("BN")[$AC](o),[e,u,m,h,p,b]})(i);c[w]=`合計ポスト数 ${t} / 閲覧 ${e} / コメ ${a} / いいね ${n} / スター ${o} / シェア `+r+c[w][p](u,""),R()}),r("コメ統計表出力",async()=>{f(),c[w]="処理中…<br><br>";var[t,e,a]=await(async a=>{let u="\ufeff",[t,e,n,m,h]=[0,0,0,0,0],p=document[$]("table");c[$AC](p);var o=document[$]("tr");o[w]=`<th>${g+D+v+D+C+_+D+s+D+b+D+L}</th>`,p[$AC](o),u+=[g,v,C,_,s,b,L].map(y).join(",")+"\r\n";do{if(d)return;try{var r=await(await fetch(`https://bbs-api-os.hoyolab.com/community/post/wapi/userReply?offset=${t}&size=20&uid=`+a)).json();r.data.list.forEach(t=>{let{reply:{post_id:e,created_at:a,content:n,game_name:o},stat:{reply_num:r,like_num:i,sub_num:d}}=t;t=S(a);let c=n.substring(0,50);50==c.length&&(c+="..."),r&&!d&&(d="--");var l="https://www.hoyolab.com/article/"+e,s=document[$]("tr");s[w]=`<td>${t+E+o+E}<a href="${l}" target="_blank">${c}</a>${E+r+E+d+E+i}</td>`,p[$AC](s),u+=[t,o,c,l,r,d,i].map(y).join(",")+"\r\n",m+=r,h+=i}),n+=r.data.list.length,{is_last:e,next_offset:t}=r.data}catch(t){c.textContent="エラー: "+t.message;break}}while(!e);return l("cD")&&l("cD").remove(),(o=document[$]("button")).textContent="CSV保存",o.id="cD",o.addEventListener("click",async()=>{var t=new Blob([u],{type:"text/csv"}),t=URL.createObjectURL(t),e=document[$]("a");e.href=t,e.download=`userReplySummary-${a}.csv`,e.click(),URL.revokeObjectURL(t)}),l("BN")[$AC](o),[n,m,h]})(i);c[w]=`合計コメ数 ${t} / リプ ${e} / いいね `+a+c[w][p](u,""),R()})}if(2==e){let m=window.location.href[p]("https://www.hoyolab.com/article/","");if(!m)return alert("投稿が見つからないよ。URLを確認してね");n="https://cdn.jsdelivr.net/npm/dompurify@2.3.10/dist/purify.min.js",await new Promise((t,e)=>{var a=document[$]`script`;a.src=n,a.onload=t,a.onerror=e,document.body[$AC](a)});let t=o(),h=l("CT");l("Cb").addEventListener("click",()=>{t.close(),document.body.removeChild(t)}),r("統計カウント",async()=>{f(),h[w]="処理中…<br><br>";var t="https://bbs-api-os.hoyolab.com/community/post/wapi/getPostFull?post_id="+m;try{var{post:{subject:e,content:a},stat:{view_num:n,reply_num:o,like_num:r,bookmark_num:i},classification:{name:d},game:{game_name:c},collection:l}=(await(await fetch(t)).json()).data.post,s=(l||{}).title,u=DOMPurify.sanitize(a,{ALLOWED_TAGS:[],ALLOWED_ATTR:{}})[p](/\s+/g,"").length;h[w]=`<br>${e} (${u}文字)<br>閲覧 ${n} / コメ ${o} / いいね ${r} / スター ${i}<br>カテゴリ ${c} > ${d||"未分類"} / コレクション `+(s||"なし")}catch(t){h.textContent="エラー: "+t.message}R()})}function o(){var t=document[$]("style"),t=(t.textContent="html:has(dialog[open]){overflow:hidden}#D::backdrop{backdrop-filter:blur(5px);background:#5558}#D{border-radius:10px;height:80vh;left:10vw;padding:20px;text-align:center;top:10vh;width:80vw}table{border:2px solid #000;border-collapse:collapse;width:100%}th{background-color:#000;border:1px solid #fff;color:#fff}td,th{padding:3px 0}td{border:1px solid #000}td:first-child,td:nth-child(2){width:12%}td:nth-child(n+4){padding-right:3px;text-align:right;width:5%}button{border:none;border-radius:5px;cursor:pointer;margin:5px;padding:10px}#Cb{background:pink}",document.head[$AC](t),document[$]("dialog"));return t.id="D",t[w]='<div><span id="BN"></span><button id="Cb">終了</button></div><p id="CT">Ver 1.3.0</p>',document.body[$AC](t),t.showModal(),t}function r(t,e){var a=document[$]("button");a.textContent=t,a.addEventListener("click",e),l("BN")[$AC](a)}function f(){t("table").forEach(t=>t.remove()),t("#BN *").forEach(t=>t.style.display="none")}function R(){t("#BN *").forEach(t=>t.style.display="inline-block")}function S(t){t=new Date(1e3*t);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,0)}-${String(t.getDate()).padStart(2,0)} ${String(t.getHours()).padStart(2,0)}:`+String(t.getMinutes()).padStart(2,0)}})();